{"version":3,"file":"index.umd.min.js","sources":["../src/utils/useHandler.ts","../src/useBackboneEventListener.ts","../src/useBackboneGetter.ts"],"sourcesContent":["import { useCallback, useRef } from 'react';\nimport type AnyFunction from '../types/AnyFunction';\n\n/**\n * React.js Hook that provides a handler function that persists its reference,\n * but calls the most recent received callback.\n *\n * @example\n *\n * ```js\n * const Button = memo(ui.Button);\n *\n * function Count() {\n *   const [count, setCount] = useState(0);\n *\n *   const handleClick = useHandler(() => {\n *     setCount(count + 1);\n *   });\n *\n *   // This Button won't re-render because its props' values never change.\n *   return (\n *     <>\n *       Count: {count}\n *       <Button onClick={handleClick}>+1</Button>\n *     </>\n *   );\n * }\n * ```\n */\nfunction useHandler<THandler extends AnyFunction>(handler: THandler): THandler {\n  const handlerRef = useRef(handler);\n\n  handlerRef.current = handler;\n\n  function executeHandler(this: ThisType<THandler>) {\n    // 'Function.prototype.apply' requires an ArrayLike, so 'arguments' is fine.\n    // eslint-disable-next-line prefer-rest-params\n    return handlerRef.current.apply(this, arguments as Parameters<THandler>);\n  }\n\n  return useCallback<THandler>(executeHandler as THandler, []);\n}\n\nexport default useHandler;\n","import type { Events } from 'backbone';\nimport { useEffect } from 'react';\nimport useHandler from './utils/useHandler';\n\n/**\n * React.js Hook that listens model's, or collection's, events and execute the\n * callback when they happen. It also pass model, or collection, as context to\n * the callback.\n *\n * @example\n *\n * ```js\n * useListenTo(user, ['sync', 'change'], function (this: UserModel) {\n *   updatePermissions(this.get('roles'));\n * });\n * ```\n */\nfunction useBackboneEventListener<TObject extends Events>(\n  object: TObject,\n  eventOrEvents: string | string[],\n  callback: (this: TObject, ...args: unknown[]) => void,\n) {\n  const events = Array.isArray(eventOrEvents)\n    ? eventOrEvents.join(' ')\n    : eventOrEvents;\n\n  const handler = useHandler(callback);\n\n  useEffect(() => {\n    if (!events) return;\n\n    object.on(events, handler);\n\n    return () => {\n      object.off(events, handler);\n    };\n  }, [object, events, handler]);\n}\n\nexport default useBackboneEventListener;\n","import type { Events } from 'backbone';\nimport { useEffect, useState } from 'react';\nimport useHandler from './utils/useHandler.js';\nimport useBackboneEventListener from './useBackboneEventListener.js';\n\n/**\n * Function that uses a model, or a collection, and a list of values as\n * parameters to get the result.\n *\n * @example\n *\n * ```ts\n * const getAvatar: GetterFunction<Model<User>, [AppDetails]> = (user, app) => {\n *   return `${app.baseUrl}/avatar/${user.get('companyId')}/${user.get('id')}`;\n * };\n * ```\n */\nexport type BackboneGetterFunction<\n  TResult,\n  TObject extends Events,\n  TValues extends unknown[] = [],\n> = (object: TObject, ...values: TValues) => TResult;\n\n/**\n * Object that contains the model, or the collection, and a list values and\n * events to watch in order to get some heavy calculated result.\n *\n * @example\n *\n * ```ts\n * const options: GetterOptions<Model<User>, [AppDetails]> = {\n *   model: user,\n *   watch: {\n *     values: [app],\n *     events: ['']\n *   }\n * }\n * ```\n */\nexport type BackboneGetterOptions<\n  TObject extends Events,\n  TValues extends unknown[] = [],\n> = {\n  object: TObject;\n  watch?: {\n    values?: TValues;\n    events?: string[];\n  };\n};\n\n/**\n * React.js Hook that calculates a result derived from the received model, or\n * collection, and a list values. It's calculated on the first-render and\n * every time watched values change, or watched events are emitted.\n *\n * @remarks\n *\n * ⚠️ it doesn't react to getter function's change, only to 'object' and the\n * watched 'values' and 'events'.\n *\n * @example\n *\n * ```ts\n * type User = Model<{\n *   first_name: string;\n *   last_name: string;\n * }>;\n *\n * function getFullName(user: User) {\n *   return user.get('first_name') + ' ' + user.get('last_name');\n * }\n *\n * const fullName = useGetter(getFullName, {\n *   object: user,\n *   watch: {\n *     events: ['sync', 'change'],\n *   },\n * });\n * ```\n */\nfunction useBackboneGetter<\n  TResult,\n  TObject extends Events,\n  TValues extends unknown[] = [],\n>(\n  getter: BackboneGetterFunction<TResult, TObject, TValues>,\n  options: BackboneGetterOptions<TObject, TValues>,\n) {\n  const { object, watch: { values = [], events = [] } = {} } = options;\n\n  const getResult = useHandler(() => {\n    return getter(object, ...(values as TValues));\n  });\n\n  const [result, setResult] = useState(getResult);\n\n  const updateResult = () => setResult(getResult);\n\n  useEffect(updateResult, [object, ...values]);\n\n  useBackboneEventListener(object, events, updateResult);\n\n  return result;\n}\n\nexport default useBackboneGetter;\n"],"names":["useHandler","handler","handlerRef","useRef","current","useCallback","apply","this","arguments","useBackboneEventListener","object","eventOrEvents","callback","events","Array","isArray","join","useEffect","on","off","getter","options","_a","watch","_b","_c","values","_d","getResult","__spreadArray","_e","useState","result","setResult","updateResult"],"mappings":";;;;;gSA6BA,SAASA,EAAyCC,GAChD,IAAMC,EAAaC,SAAOF,GAU1B,OARAC,EAAWE,QAAUH,EAQdI,EAAWA,aANlB,WAGE,OAAOH,EAAWE,QAAQE,MAAMC,KAAMC,aAGiB,ICvB3D,SAASC,EACPC,EACAC,EACAC,GAEA,IAAMC,EAASC,MAAMC,QAAQJ,GACzBA,EAAcK,KAAK,KACnBL,EAEEV,EAAUD,EAAWY,GAE3BK,EAAAA,WAAU,WACR,GAAKJ,EAIL,OAFAH,EAAOQ,GAAGL,EAAQZ,GAEX,WACLS,EAAOS,IAAIN,EAAQZ,MAEpB,CAACS,EAAQG,EAAQZ,sPC4CtB,SAKEmB,EACAC,GAEQ,IAAAX,EAAqDW,EAA/CX,OAAEY,EAA6CD,EAALE,MAAxCC,OAAsC,IAAAF,EAAA,GAAEA,EAA/BG,WAAAC,OAAS,IAAAD,EAAA,GAAEA,EAAEE,EAAWH,EAAAX,OAAXA,OAAM,IAAAc,EAAG,GAAEA,EAE3CC,EAAY5B,GAAW,WAC3B,OAAOoB,EAAMd,WAAA,EAAAuB,EAAA,CAACnB,GAAYgB,GAAoB,OAG1CI,EAAsBC,EAAAA,SAASH,GAA9BI,EAAMF,EAAA,GAAEG,EAASH,EAAA,GAElBI,EAAe,WAAM,OAAAD,EAAUL,IAMrC,OAJAX,EAASA,UAACiB,EAAYL,EAAA,CAAGnB,GAAWgB,OAEpCjB,EAAyBC,EAAQG,EAAQqB,GAElCF"}